# Railway Deployment Checklist

## ‚úÖ Pre-Deployment Verification

### 1. **Build Process**
- [x] `npm run build:all` works without errors
- [x] Server files compile to `dist/server/`
- [x] Frontend files compile to `dist/`
- [x] Shared entities compile to `dist/shared/`

### 2. **Railway Configuration**
- [x] `railway.json` configured with correct build/deploy commands
- [x] `Procfile` points to `npm start`
- [x] Health check endpoint at `/health`
- [x] NODE_ENV=production set in railway.json
- [x] NODE_VERSION=24 set in railway.json
- [x] `.nvmrc` file specifies Node.js 24
- [x] `engines` field in package.json requires Node.js 24+

### 3. **Database Setup**
- [x] PostgreSQL configuration with SSL for production
- [x] DATABASE_URL environment variable support
- [x] Migration system working (`npm run db:migrate`)

### 4. **Session Management**
- [x] Cookie-session configured (no Redis dependency)
- [x] SESSION_SECRET environment variable
- [x] Secure cookies in production

## üöÄ Railway Deployment Steps

### Step 1: Connect Repository
1. Go to [Railway](https://railway.app)
2. Click "New Project" ‚Üí "Deploy from GitHub repo"
3. Select your repository

### Step 2: Configure Environment Variables
Set these environment variables in Railway:

```bash
# Required Database
DATABASE_URL=postgresql://user:password@host:port/database

# Required Session
SESSION_SECRET=your-super-secret-session-key-must-be-32-chars-long
SESSION_NAME=intai.sid
SESSION_MAX_AGE=2592000000

# Optional SMS (Twilio)
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token  
TWILIO_PHONE_NUMBER=+1234567890

# Optional Email
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASS=your_app_password
FROM_EMAIL=noreply@intai.dev
```

### Step 3: Deploy
1. Railway will automatically detect the `railway.json` configuration
2. It will run `npm run build:all` during build
3. It will run `npm start` to start the server
4. Database migrations will run automatically via `postbuild` script

### Step 4: Verify Deployment
- Check health endpoint: `https://your-app.railway.app/health`
- Test authentication flow
- Verify database connection

## üìã Environment Variables Reference

### Required Variables
- `DATABASE_URL` - PostgreSQL connection string
- `SESSION_SECRET` - Must be 32+ characters for security
- `NODE_ENV` - Set to "production" (configured in railway.json)
- `NODE_VERSION` - Set to "24" (configured in railway.json)
- `PORT` - Railway will set this automatically

### Optional Variables
- `TWILIO_ACCOUNT_SID` - For SMS OTP
- `TWILIO_AUTH_TOKEN` - For SMS OTP
- `TWILIO_PHONE_NUMBER` - SMS sender number
- `SMTP_*` - Email configuration
- `CORS_ORIGINS` - Comma-separated allowed origins

## üîß Post-Deployment Setup

### Database
1. Railway will automatically create a PostgreSQL database
2. Copy the DATABASE_URL from Railway dashboard
3. Migrations will run automatically

### Custom Domain (Optional)
1. Go to Railway project settings
2. Add custom domain
3. Update CORS_ORIGINS if needed

### Monitoring
- Health check: `/health`
- Server logs available in Railway dashboard
- Database logs available in Railway dashboard

## üêõ Troubleshooting

### Common Issues
1. **Build fails**: Check TypeScript compilation errors
2. **Server won't start**: Check environment variables
3. **Database connection fails**: Verify DATABASE_URL format
4. **Sessions don't work**: Check SESSION_SECRET is set

### Debug Commands
```bash
# Test build locally
npm run build:all

# Test server locally
npm start

# Test database connection
npm run db:migrate
```

## üîê Security Notes
- SESSION_SECRET must be kept secret and be 32+ characters
- Database credentials auto-generated by Railway
- HTTPS enforced in production automatically
- Secure cookies enabled in production

## üìä Performance
- Server starts in ~2-3 seconds
- Database migrations run automatically
- Static files served by Express
- Health check timeout: 100 seconds 